<!DOCTYPE html>

<html>
<head>
	<meta charset="UTF-8">
	<title>twitter</title>
	<link rel="stylesheet" href="./css/style.css" type="text/css" />
	<script src="/socket.io/socket.io.js"></script>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	<script src="https://cdn.rawgit.com/urin/jquery.balloon.js/master/jquery.balloon.js"></script>
</head>
<body>

<script>
$(function() {
	var socket = io.connect();
	$('form').submit(function() {
		socket.emit('msg', $('input').val());
		$('input').val('');
		return false;
	});

	var count = 0;
	socket.on('msg', function(data) {
		outer(data)
		count += 1;
		var user = data.user
		var src = "<img src=" + user.profile_image_url + " id = "+ user.id + ">";
		var follower = user.followers_count
		var radius = 0;
		if (follower < 100) {
		radius = 50;
		} else if(follower < 300){
		radius = 70;
		} else {
		radius = 90
		}

		var rand_w = Math.floor(Math.random() * $(window).width())
		var rand_h = Math.floor(Math.random() * $(window).height())

		$('#main').append(src)
		$('#'+user.id)
				.css('position', 'absolute')
				.css('left', rand_w)
				.css('top', rand_h)
				.wrap('<a href="https://twitter.com/' + user.screen_name + '" target="_blank"></a>')
		$('#'+user.id).balloon({
		showDuration: "slow",
		showAnimation: function(d, c) { this.fadeIn(d, c); },
		css: { width: '200px' },
		contents: data.text
		})

		$('#'+user.id).css('width', radius + 'px')
					.css('border-radius', '50%');
	});
	
	function outer(data){
		var int = setInterval(function(){
			socket.off()
			$('#modal-trigger').attr('checked', 'checked')
		}, 5000)
		
		var speed = count / 5;
		$('h1.title').text(data.keyword + ' の風速！');
		$('h2.speed').text(speed + ' tweets/秒');
	}
});
</script>
<!-- <form><input></form> -->
<!-- <div id='overlay'></div> -->
<div class="modal">
	<input id="modal-trigger" type="checkbox">
	<div class="modal-overlay">
		<div class="modal-wrap">
			<h1 class='title'></h1>
			<h2 class='speed'></h2>
			<label for="modal-trigger">とじる</label>
		</div>
	</div>
</div>
<div id='main'></div>
</body>
</html>
